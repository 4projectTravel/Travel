{% extends 'base.html' %}

{% block title %}スポット一覧{% endblock %}
{% block h1 %}スポット一覧{% endblock %}

{% block extrajs %}
<script type="text/javascript">
  // いいねボタンが押された時
  document.getElementById('ajax-like').addEventListener('click', e => {
    e.preventDefault();
    const url = '{% url "postlike" %}';
    fetch(url, {
      method: 'POST',
      body: `post_pk={{ post.pk }}`,
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8',
        'X-CSRFToken': '{{ csrf_token }}',
      },
    }).then(response => {
      return response.json();
    }).then(response => {
      const counter = document.getElementById('like-count')
      counter.textContent = response.like_count
      const icon = document.getElementById('like-icon')
      // いいねした時はハートを塗る
      if (response.method == 'create') {
        icon.classList.remove('far')
        icon.classList.add('fas')
        icon.id = 'like-icon'
      } else {
        icon.classList.remove('fas')
        icon.classList.add('far')
        icon.id = 'like-icon'
      }
    }).catch(error => {
      console.log(error);
    });
  });
</script>
{% endblock %}

{% block content %}
      <!--formを追加-->
       <form action="" method="get"><!-- getメソッドでインデックス関数を呼び出す -->
         <input name="query" value="{{ request.GET.query }}"　type="text" placeholder=" スポット名を入力 "/>
  　　　　<button type="submit">検索</button>
       </form>

       <!--<form action="" method="get2"><!-- getメソッドでインデックス関数を呼び出す -->
         <!--<label><input type="checkbox" class="checks" name="query2">お気に入り登録したスポットのみ表示</label>
         <input type="button" value="表示" ></input>
       </form>-->

      <div class="main">
        {% for item in post_list %}
        <div class="item">
          <div class="p-4 m-4 bg-light border border-info rounded">
            {% if is_user_liked %}
            <button type="button" id="ajax-like" style="border:none;background:none">
              <!-- すでにいいねしている時はfasクラス -->
              <i class="fas fa-heart text-danger" id="like-icon"></i>
            </button>
            {% else %}
            <button type="button" id="ajax-like" style="border:none;background:none">
              <!-- いいねしていないときはfarクラス -->
              <i class="far fa-heart text-danger" id="like-icon"></i>
            </button>
            {% endif %}
            <a href="{% url 'detail-post' item.pk %}"><h2 class="text-info">{{ item.number }}.{{ item.name }}</h2></a>
            {% if item.thumbnail %}
               <a class="thumbnail"><img src="{{ item.thumbnail.url }}" class="img-thumbnail" /></a>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>



　　<a href="{% url 'create-post' %}" class="btn btn-light">スポットを追加する</a>

　　<a href="{{request.META.HTTP_REFERER}}">前のページに戻る</a>

    {% include 'post/components/pagination.html' %}
{% endblock content %}
